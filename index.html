<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>羽球排點系統 (Badminton Lineup)</title>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Fonts & Icons -->
  <link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&family=Noto+Sans+TC:wght@300;400;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <!-- Drag and Drop Touch Polyfill -->
  <script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>

  <link rel="stylesheet" href="lineup.css">
</head>

<body>

  <!-- Top Configuration Bar -->
  <header class="app-header">
    <div class="logo">
      <i class="fas fa-feather-alt gold-icon"></i>
      <h1>Badminton <span class="gold-text">Pro</span> Lineup</h1>
    </div>
    <div class="controls">
      <span id="onlineCount"
        style="font-size: 0.9rem; color: #4ade80; background: rgba(74, 222, 128, 0.1); padding: 4px 12px; border-radius: 20px; border: 1px solid rgba(74, 222, 128, 0.2); white-space: nowrap;">🟢
        1 人在線</span>
      <button id="addCourtBtn" class="btn btn-silver"><i class="fas fa-plus"></i> 新增場地</button>
      <div class="toggle-group">
        <span class="label">自動輪轉</span>
        <label class="switch">
          <input type="checkbox" id="autoModeToggle">
          <span class="slider round"></span>
        </label>
      </div>
      <div class="toggle-group">
        <span class="label">計分板</span>
        <label class="switch">
          <input type="checkbox" id="scoreModeToggle" checked>
          <span class="slider round"></span>
        </label>
      </div>
      <button id="helpBtn" class="btn btn-silver"><i class="fas fa-question-circle"></i> 說明</button>
      <button id="resetBtn" class="btn btn-danger"><i class="fas fa-trash-alt"></i> 重置</button>
    </div>
  </header>

  <div class="main-container">

    <!-- Left Panel: Waiting Queue -->
    <aside class="panel queue-panel">
      <div class="panel-header">
        <h2><i class="fas fa-hourglass-half"></i> 等待列 (Queue)</h2>
        <div class="queue-stats">
          <span id="queueCount">0</span> 組等待中
        </div>
      </div>
      <div id="queueContainer" class="queue-list drop-zone" data-type="queue">
        <!-- Queue Groups will be dynamic -->
        <div class="empty-state">暫無等待組別</div>
      </div>
    </aside>

    <!-- Center Panel: Courts -->
    <main class="panel court-panel">
      <div id="courtsContainer" class="courts-grid">
        <!-- Courts will be injected here via JS -->
      </div>
    </main>

    <!-- Right Panel: Player Pool -->
    <aside class="panel players-panel">
      <div class="panel-header">
        <h2><i class="fas fa-users"></i> 球員名單</h2>
        <button id="addPlayerBtn" class="icon-btn"><i class="fas fa-user-plus"></i></button>
      </div>

      <div class="filter-bar">
        <input type="text" id="searchPlayer" placeholder="搜尋姓名...">
      </div>

      <div id="playerPool" class="player-grid drop-zone" data-type="pool">
        <!-- Players injected here -->
      </div>
    </aside>

  </div>

  <!-- Selection Box (Marquee) -->
  <div id="selectionBox" class="selection-box hidden"></div>

  <!-- Drag Proxy (Ghost) -->
  <div id="dragProxy" class="drag-proxy hidden"></div>

  <!-- Add Player Modal -->
  <div id="modalOverlay" class="modal-overlay hidden">
    <div class="modal gold-border">
      <h3>新增球員</h3>
      <div class="input-group">
        <label>姓名</label>
        <input type="text" id="newPlayerName" placeholder="輸入姓名">
      </div>
      <div class="input-group">
        <label>性別</label>
        <select id="newPlayerGender">
          <option value="male">男</option>
          <option value="female">女</option>
        </select>
      </div>
      <div class="input-group">
        <label>程度 (1-10)</label>
        <input type="number" id="newPlayerLevel" min="1" max="10" value="5">
      </div>
      <div class="modal-actions">
        <button id="cancelModalBtn" class="btn btn-silver">取消</button>
        <button id="confirmAddPlayerBtn" class="btn btn-gold">新增</button>
      </div>
    </div>
  </div>

  <!-- Edit Player Modal -->
  <div id="editModalOverlay" class="modal-overlay hidden">
    <div class="modal gold-border">
      <h3 style="display:flex; justify-content:space-between; align-items:center;">
        編輯球員
        <button id="deletePlayerBtn" class="btn btn-danger btn-sm"
          style="font-size:0.8rem; padding:4px 8px;">刪除</button>
      </h3>
      <input type="hidden" id="editPlayerId">
      <div class="input-group">
        <label>姓名</label>
        <input type="text" id="editPlayerName" placeholder="輸入姓名">
      </div>
      <div class="input-group">
        <label>性別</label>
        <select id="editPlayerGender">
          <option value="male">男</option>
          <option value="female">女</option>
        </select>
      </div>
      <div class="input-group">
        <label>程度 (1-10)</label>
        <input type="number" id="editPlayerLevel" min="1" max="10">
      </div>
      <div class="modal-actions">
        <button id="cancelEditModalBtn" class="btn btn-silver">取消</button>
        <button id="confirmEditPlayerBtn" class="btn btn-gold">儲存</button>
      </div>
    </div>
  </div>

  <!-- Confirm Modal -->
  <div id="confirmModalOverlay" class="modal-overlay hidden">
    <div class="modal gold-border" style="width: 400px;">
      <h3 id="confirmTitle" style="margin-top:0;">確認</h3>
      <p id="confirmMessage" style="color:#ddd; margin-bottom:20px;">內容</p>
      <div class="modal-actions">
        <button id="cancelConfirmBtn" class="btn btn-silver">取消</button>
        <button id="doConfirmBtn" class="btn btn-gold">確定</button>
      </div>
    </div>
  </div>

  <!-- Floating Action Button for Mobile/Quick Add -->
  <div id="quickAddBtn" class="fab-btn hidden">
    <i class="fas fa-plus"></i> 加入列隊
  </div>

  <!-- System Lock Overlay -->
  <div id="systemLockOverlay" class="modal-overlay hidden" style="background: rgba(0,0,0,0.4); z-index: 9999;">
    <div class="modal gold-border" style="width: auto; padding: 20px 40px; display:flex; align-items:center; gap:15px;">
      <div
        style="width: 20px; height: 20px; border: 3px solid var(--gold-start); border-top: 3px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;">
      </div>
      <h3 style="margin:0; color:white; font-size:1.1rem;">其他使用者正在操作中...</h3>
    </div>
  </div>

  <style>
    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>

  <!-- Help Modal -->
  <div id="helpModal" class="modal-overlay hidden" style="z-index: 2200;">
    <div class="modal gold-border" style="width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
      <div class="modal-header"
        style="text-align:center; padding-bottom:10px; border-bottom:1px solid rgba(255,255,255,0.1); margin-bottom:15px;">
        <h2 style="margin:0; color: var(--gold-start); font-size: 1.5rem;"><i class="fas fa-book-reader"></i> 使用說明</h2>
      </div>
      <div class="modal-body" style="text-align: left; line-height: 1.6; color: #ddd; font-size: 0.95rem;">
        <h3 style="color:#fff; margin-bottom:5px; margin-top:0;">1. 新增球員</h3>
        <p style="margin-bottom:15px; margin-top:0;">點擊右上角 <i class="fas fa-plus"></i> 或手機浮動按鈕。輸入姓名與性別即可。</p>

        <h3 style="color:#fff; margin-bottom:5px;">2. 建立排隊 (Queue)</h3>
        <p style="margin-bottom:15px; margin-top:0;">在球員名單中，用滑鼠<b>框選</b>球員(最多4人)，或單點選取，再點擊「加入列隊」。手機版可直接點選頭像。</p>

        <h3 style="color:#fff; margin-bottom:5px;">3. 上場比賽</h3>
        <p style="margin-bottom:15px; margin-top:0;">將左側「等待列」的整組球員，<b>拖曳</b>到空閒的場地上。手機版長按拖曳。</p>

        <h3 style="color:#fff; margin-bottom:5px;">4. 結束/輪轉</h3>
        <p style="margin-bottom:15px; margin-top:0;">比賽結束點擊「結束」。開啟「自動輪轉」時，結束後會自動把下一組排上去。</p>

        <h3 style="color:#fff; margin-bottom:5px;">5. 防衝突系統</h3>
        <p style="margin-bottom:10px; margin-top:0;">當看到「其他使用者操作中」畫面時，請稍候幾秒，這是防止多人同時拖曳造成資料錯亂。</p>
      </div>
      <div class="modal-actions" style="margin-top:20px; text-align:center;">
        <button id="closeHelpBtn" class="btn btn-silver" style="width:100%;">我知道了</button>
      </div>
    </div>
  </div>

  <script src="lineup.js"></script>
</body>

</html>